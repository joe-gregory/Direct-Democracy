<%- include('./partials/head.ejs') %>
<%- include('./partials/navigation.ejs') %>
<h1 class = 'pageTitle'>Crear nueva propuesta</h1>

<div class = 'container'>
    <form method = 'post' action = '/mycommunity/createproposal'>
        <div class = 'mb-3'>
            <label class = 'form-label' for = 'community'>Elige la comunidad para la que haces la propuesta</label>
            <select name = 'community' class = 'form-select' id = 'communities' required="true">
                <option disabled selected>Elige para que comunidad es la propuesta</option>
                <% for(let i = 0; i < locals.communities.length; i++){ %>
                    <%- `<option value = "${locals.communities[i].id}">${locals.communities[i].name}</option>` %>
               <% } %>
            </select>
        </div>
        <div class = 'mb-3'>
            
            <label class = 'form-label' for = 'type'>Elige el tipo de propuesta</label>
            <select name = 'type' class = 'form-select' id = 'citizenActions' required="true">
                <option disabled selected>Elige tipo de propuesta</option>
                <option value ="createLaw">Crear una nueva ley</option>
                <option value ="deleteLaw">Eliminar una ley existente</option>
                <option value ="editLaw">Hacerle cambios a una ley existente</option>
                <option value ="createRole">Crear un puesto/rol</option>
                <option value ="deleteRole">Eliminar un puesto/rol</option>
                <option value ="editRole">Cambiar detalles de un puesto/rol</option>
                <option value ="assignRole">Asignar un puesto/rol a un ciudadano</option>
                <option value ="removeRole">Remover a un ciudadano de su puesto</option>
                <option value ="swapRole">Intercambiar ciudadano para un puesto/rol</option>
                <option value ="createProject">Proponer un nuevo proyecto</option>
                <option value ="createBadge">Crear una nueva medalla</option>
                <option value ="assignBadge">Asignar una medalla</option>
                <option value ="permit">Pedir un permiso a la comunidad</option>
            </select>
        </div>
        <div class = 'mb-3'>
            <label class = 'form-label' for = 'title'>Titulo de la propuesta</label>
            <input class="form-control" id = 'title' name = 'title' type = 'text' required="true">
        </div> 
        <div class = 'mb-3'>
            <label class = 'form-label' for = 'body'>Argumentos a favor de la propuesta</label>
            <textarea id = 'body' class = 'form-control' name = 'body' type = 'text' required="true" placeholder="Describe la razon de tu propuesta, tus argumentos y otra informacion que apoye tu propuesta para que tus vecinos entiendan mas el contexto"></textarea>
        </div>

        
        <div id = 'createLawInput' class = 'd-none'>
            <div class = 'mb-3'>
                <label class = 'form-label' for = 'citizenActionTitle' required = "true">Titulo de la ley</label>
                <input class="form-control" id = 'citizenActionTitle' name = 'citizenActionTitle' type = 'text'>
            </div>
            <div class = 'mb-3'>
                <label class = 'form-label' for = 'citizenActionBody'>Texto de la ley</label>
            <textarea id = 'citizenActionBody' class = 'form-control' name = 'citizenActionBody' type = 'text' required="true"></textarea>
            </div>
            <div class = 'mb-3'>
                <label class = 'form-label' for = 'citizenActionStartDate'>En que fecha tomaria inicio esta ley</label>
                <input type="date" name="citizenActionStartDate" required = "true" id='citizenActionStartDate'/>
            </div>
            <div class = 'mb-3'>
                <label class = 'form-label' for = 'citizenActionExpirationDate'>En que fecha expiraria esta ley (opcional)</label>
            <input type="date" name="citizenActionExpirationDate" id='citizenActionExpirationDate'/>
            </div>
        </div>

        <div id = 'removeLawInput' class = 'mb-3 d-none'>
        </div>

        <div class = 'mb-3'>
            <button class = 'btn' id='loginButton' type = 'submit' disabled>Crear Propuesta</button>
        </div>
    
    </form>
</div>
<script>
    $('#citizenActions').on('change', function() {
        //Show options based on selection. #1 show  
        if($('#citizenActions option:selected').val() == 'createLaw') {
            $('#createLawInput').removeClass('d-none');
            $('#removeLawInput').addClass('d-none');
            $('#loginButton').removeAttr('disabled');
        } else if($('#citizenActions option:selected').val() == 'delete') {
            $('#createLawInput').addClass('d-none');
            $('#removeLawInput').removeClass('d-none');
            $('#loginButton').removeAttr('disabled');
            $.ajax({
                url: '/mycommunity/createproposal/delete',
                type: 'GET',
                dataType: 'json',
                cache: false,
                success: function(data) {
                    if(data.laws){
                        console.log('laws passed ', data.laws);
                        $('#removeLawInput').empty();
                        for(let i = 0; i < data.laws.length; i++) {
                            let section = $('<div></div>').attr('class', 'container mb-3');
                            section.append($('<input></input>').val(data.laws[i]._id).attr('type','radio').attr('name','law'));
                            section.append($('<label></label>').attr('for', data.laws[i]._id).html(`Ley #${i+1}:`));
                            section.append($('<p></p>').text(`${data.laws[i].law}`));
                            $('#removeLawInput').append(section);
                        }
                    }
                }, 
                error: (error) => {alert(error);}
            });
        }
    });
    //get citizens communities

</script>

<%- include('./partials/footer.ejs') %>